version: '3.8'

services:
  manager:
    build:
      context: ..
      dockerfile: build/manager/Dockerfile
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    volumes:
      - ../shared_volume:/app/shared_volume
    environment:
      - NUM_ITERATIONS=3     # total Bayesian optimization iterations
      - BATCH_SIZE=2         # number of hyperparam sets per iteration
      - SEED=42
      - MODEL_CHOICE=svm     # or "xgb" or "lgbm"
      - CUDA_VISIBLE_DEVICES=2
    command: ["python3", "manager.py"]

  worker:
    build:
      context: ..
      dockerfile: build/worker/Dockerfile
    volumes:
      - ../shared_volume:/app/shared_volume
    environment:
      - MODEL_CHOICE=svm
      - SEED=42
    command: ["python3", "train.py"]
